**思考几个问题：**

1. 如何设计一个支持海量商品存储的高扩展架构？
2. 在做分库分表时，基于Hash取模和一致性Hash的数据分片如何实现的？
3. 在电商大促时期，如何对热点商品数据做存储策略？
4. 强一致性和最终一致性的数据共识算法如何实现的？

海量数据存储可以从以下思考线入手

1. 海量数据存储多机存储必做分片。
2. 分片副本是高可用的唯一手段，思考主副之间同步复制
3. 主副之间同步有数据容错，一致性问题。
4. 一致性需要的协议算法是什么？



**深入思考项**

1. 分片
   1. hash分片，
   2. 一致性hash分片，解决数据分布不均和不易扩展问题。
   3. 范围分片：解决单一热点问题。
2. 副本
   1. 解决可用性问题
3. 一致性
   1. 一致性算法解决一致性问题，一致性算法即共识算法。



**思考项详解：**

hash分片算法

- hash某值对节点数取模，可以把数据路由到各节点。比如商品数据，根据商品ID做hash，之后再取模。公式：hash(商品ID)%4=结果(总是在小于4的范围内)。这种算法的不足之处是数据分布不均匀，扩展性差。

一致性hash

- 将存储节点和数据都映射到一个首发相连的hash环上，存储节点一般可以根据IP地址进行hash计算，数据的存储位置是从数据映射在环上的位置开始，依照顺时针方向所找到的第一个存储节点存储。此方法可解决数据分布不均匀和扩展性差的问题。单一热点数据就无能为力，但范围分片算法可以解决此问题。

范围分片

- 拿电商来说，可以依据品类做为范围来分片，热点数据按三级分类划分，冷数据可以按一级分类划分。要达到这种灵活性，更好的方式是基于分片元数据。分片元数据包括分片信息及数据量、读写QPS和分片副本的健康状态。这种分片元数据的原理可以参考hbase的Hmaster，道理相通。

共识算法

- paxos
- basic paxos
- multi paxos
- fast paxos
- raft
- gossip